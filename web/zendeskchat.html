<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Zendesk GPT-5 Chat</title>
    <link href="./original/dist/css/tabler.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-themes.css?1747674014" rel="stylesheet" />
    <style>
      @import url("https://rsms.me/inter/inter.css");
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: var(--tblr-body-bg, #f5f7fb);
      }
      .navbar-brand-title {
        font-size: 1.375rem;
        font-weight: 600;
        color: inherit;
      }
      .page-title {
        font-size: 1.875rem;
        font-weight: 600;
      }
      .card-chat {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      .card-chat .card-body {
        flex: 1 1 auto;
        padding: 0;
        overflow: hidden;
      }
      .chat-log {
        height: 100%;
        max-height: min(65vh, 640px);
        overflow-y: auto;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        background: linear-gradient(145deg, rgba(32, 107, 196, 0.03), rgba(47, 179, 68, 0.02));
      }
      .message {
        display: flex;
        flex-direction: row;
        gap: 0.75rem;
        align-items: flex-start;
      }
      .message-user {
        flex-direction: row-reverse;
      }
      .message-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-weight: 600;
      }
      .message-user .message-avatar {
        background: var(--tblr-primary);
        color: #fff;
      }
      .message-assistant .message-avatar {
        background: rgba(32, 107, 196, 0.1);
        color: var(--tblr-primary);
      }
      .message-bubble {
        background: #fff;
        border-radius: 1rem;
        padding: 0.85rem 1rem;
        box-shadow: var(--tblr-shadow-sm, 0 1px 2px rgba(15, 23, 42, 0.08));
        max-width: min(560px, 100%);
        font-size: 0.95rem;
        line-height: 1.6;
        white-space: pre-wrap;
      }
      .message-user .message-bubble {
        background: linear-gradient(135deg, var(--tblr-primary), #1d5bbd);
        color: #fff;
        box-shadow: var(--tblr-shadow-md, 0 12px 20px -12px rgba(32, 107, 196, 0.8));
      }
      .message-meta {
        font-size: 0.75rem;
        color: var(--tblr-gray-600);
        margin-top: 0.35rem;
      }
      .message-user .message-meta {
        text-align: right;
        color: rgba(255, 255, 255, 0.7);
      }
      .typing-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--tblr-gray-600);
      }
      .typing-indicator span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
        animation: typing-bounce 1.2s infinite ease-in-out;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes typing-bounce {
        0%, 80%, 100% {
          opacity: 0.2;
          transform: translateY(0);
        }
        40% {
          opacity: 1;
          transform: translateY(-3px);
        }
      }
      .card-footer {
        border-top: 1px solid var(--tblr-border-color);
        background-color: rgba(255, 255, 255, 0.9);
      }
      #chat-input {
        resize: none;
        min-height: 80px;
        max-height: 180px;
      }
      .quick-prompts .list-group-item {
        cursor: pointer;
        border: none;
        padding: 0.75rem 1rem;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .quick-prompts .list-group-item:hover {
        transform: translateY(-1px);
        box-shadow: var(--tblr-shadow-sm, 0 8px 16px -14px rgba(15, 23, 42, 0.4));
      }
      .empty-state {
        text-align: center;
        color: var(--tblr-gray-600);
      }
      .empty-state svg {
        color: var(--tblr-primary);
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <script src="./original/dist/js/tabler-theme.min.js?1747674014"></script>
    <div class="page">
      <header class="navbar navbar-expand-md d-print-none">
        <div class="container-xl">
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbar-menu"
            aria-controls="navbar-menu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href="dash.html" class="text-reset text-decoration-none" aria-label="Zendesk Voice Dashboard">
              <span class="navbar-brand-title">Zendesk KPI Copilot</span>
            </a>
          </div>
          <div class="navbar-nav flex-row order-md-last">
            <div class="d-none d-md-flex">
              <div class="nav-item">
                <a href="?theme=dark" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-1">
                    <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
                  </svg>
                </a>
                <a href="?theme=light" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-1">
                    <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>
      <div class="page-wrapper">
        <div class="page-header d-print-none" aria-label="Page header">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <h2 class="page-title">Ask GPT-5 about your Zendesk KPIs</h2>
                <div class="text-secondary mt-1">Ask natural language questions about volume, SLA, backlog, staffing, and satisfactionâ€”GPT-5 will respond with the latest insights.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-cards align-items-stretch">
              <div class="col-12 col-lg-8">
                <section class="card card-chat" aria-labelledby="chat-heading">
                  <div class="card-header border-0 pb-0">
                    <div>
                      <h3 class="card-title mb-1" id="chat-heading">Zendesk GPT-5 Copilot</h3>
                      <p class="text-secondary mb-0">Converse in real time about ticket trends, queue health, CSAT, staffing, and more.</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chat-log" id="chat-log" role="log" aria-live="polite" aria-label="GPT-5 conversation">
                      <div class="empty-state" id="chat-empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                          <path d="M7 8h10" />
                          <path d="M7 12h8" />
                          <path d="M7 16h6" />
                          <path d="M5 20h14a2 2 0 0 0 2 -2V6a2 2 0 0 0 -2 -2H7l-4 4v10a2 2 0 0 0 2 2z" />
                        </svg>
                        <p class="mb-0">Ask GPT-5 anything about your Zendesk KPIs to get started.</p>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <form id="chat-form" class="row gx-2 gy-2 align-items-stretch" autocomplete="off">
                      <div class="col-12">
                        <label for="chat-input" class="visually-hidden">Ask a question about Zendesk KPIs</label>
                        <textarea id="chat-input" class="form-control" placeholder="Example: How did first-response time trend week-over-week?" required></textarea>
                      </div>
                      <div class="col-12 d-flex justify-content-between align-items-center">
                        <div class="form-text text-muted">
                          Press Enter to send, Shift+Enter for a new line.
                        </div>
                        <button class="btn btn-primary" type="submit" id="chat-submit">
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-send" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 14l11 -11" />
                            <path d="M21 3l-6 18a0.55 .55 0 0 1 -1 0l-3 -7l-7 -3a0.55 .55 0 0 1 0 -1l18 -6" />
                          </svg>
                          <span class="ms-1">Send</span>
                        </button>
                      </div>
                    </form>
                  </div>
                </section>
              </div>
              <div class="col-12 col-lg-4">
                <div class="card h-100 quick-prompts" aria-labelledby="prompt-heading">
                  <div class="card-header">
                    <h3 class="card-title" id="prompt-heading">Suggested prompts</h3>
                    <p class="text-secondary mb-0">Tap any prompt to drop it into the chat box.</p>
                  </div>
                  <div class="list-group list-group-flush" id="prompt-list">
                    <button type="button" class="list-group-item list-group-item-action" data-prompt="Summarize today's call and chat volumes alongside SLA performance.">
                      Summarize today's call and chat volumes alongside SLA performance.
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-prompt="Which queues had the most SLA breaches in the last 24 hours and why?">
                      Which queues had the most SLA breaches in the last 24 hours and why?
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-prompt="Compare CSAT and first-response time for the past 7 days to the previous week.">
                      Compare CSAT and first-response time for the past 7 days to the previous week.
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-prompt="Highlight any agents that are nearing capacity limits today.">
                      Highlight any agents that are nearing capacity limits today.
                    </button>
                    <button type="button" class="list-group-item list-group-item-action" data-prompt="Give me a quick executive summary I can share in stand-up.">
                      Give me a quick executive summary I can share in stand-up.
                    </button>
                  </div>
                  <div class="card-body border-top">
                    <h4 class="card-title mb-2">How it works</h4>
                    <p class="text-secondary mb-3">
                      Your questions and the full chat history are securely sent to GPT-5, which responds with insights grounded in Zendesk ticket and call data. Responses are scoped to the metrics and ranges curated for this dashboard.
                    </p>
                    <div class="d-inline-flex align-items-center px-3 py-2 rounded bg-primary-lt text-primary">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 9h.01" />
                        <path d="M11 12h1v4h1" />
                        <path d="M12 5m-7 7a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
                      </svg>
                      GPT-5 will cite data sources whenever possible.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">&copy; 2025 Zendesk Dashboard</li>
                  <li class="list-inline-item"><a href="dash.html">Voice Dashboard</a></li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <script src="./original/dist/js/tabler.min.js?1747674014" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const API_ENDPOINT = '/api/gpt5-chat';
        const chatLog = document.getElementById('chat-log');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatSubmit = document.getElementById('chat-submit');
        const promptButtons = document.querySelectorAll('[data-prompt]');
        const emptyState = document.getElementById('chat-empty-state');
        const conversation = [
          {
            role: 'system',
            content:
              'You are a Zendesk KPI copilot powered by GPT-5. You answer questions using the freshest Zendesk ticket, call, and chat insights, always providing clear explanations, metrics, and next steps. If data is unavailable, say so transparently.'
          }
        ];

        const scrollToBottom = () => {
          chatLog.scrollTo({ top: chatLog.scrollHeight, behavior: 'smooth' });
        };

        const timeStamp = () =>
          new Date().toLocaleTimeString([], {
            hour: 'numeric',
            minute: '2-digit'
          });

        const createMessageElement = (role, content, { html = false } = {}) => {
          if (emptyState) {
            emptyState.remove();
          }

          const wrapper = document.createElement('div');
          wrapper.classList.add('message', `message-${role}`);

          const avatar = document.createElement('div');
          avatar.className = 'message-avatar';
          avatar.textContent = role === 'user' ? 'You' : 'AI';

          const body = document.createElement('div');
          body.className = 'message-body';

          const bubble = document.createElement('div');
          bubble.className = 'message-bubble';
          if (html) {
            bubble.innerHTML = content;
          } else {
            bubble.textContent = content;
          }

          const meta = document.createElement('div');
          meta.className = 'message-meta';
          meta.textContent = `${role === 'user' ? 'You' : 'GPT-5 Copilot'} â€¢ ${timeStamp()}`;

          body.appendChild(bubble);
          body.appendChild(meta);

          wrapper.appendChild(avatar);
          wrapper.appendChild(body);

          chatLog.appendChild(wrapper);
          scrollToBottom();

          return { wrapper, bubble, meta };
        };

        const sendMessage = async (message) => {
          const userMessage = message.trim();
          if (!userMessage) return;

          chatForm.reset();
          chatInput.focus();

          createMessageElement('user', userMessage);
          conversation.push({ role: 'user', content: userMessage });

          const placeholder = createMessageElement(
            'assistant',
            '<div class="typing-indicator" aria-hidden="true"><span></span><span></span><span></span></div>',
            { html: true }
          );

          const setAssistantReply = (reply) => {
            placeholder.bubble.textContent = reply;
          };

          try {
            chatInput.disabled = true;
            chatSubmit.disabled = true;

            const response = await fetch(API_ENDPOINT, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ messages: conversation })
            });

            if (!response.ok) {
              throw new Error(`GPT-5 API returned ${response.status}`);
            }

            const result = await response.json();
            const assistantReply = (result && (result.reply || result.answer || result.message))?.trim();

            if (assistantReply) {
              setAssistantReply(assistantReply);
              conversation.push({ role: 'assistant', content: assistantReply });
            } else {
              setAssistantReply("I'm here, but I didn't receive a clear answer. Could you try that again?");
              conversation.push({
                role: 'assistant',
                content: "I'm here, but I didn't receive a clear answer. Could you try that again?"
              });
            }
          } catch (error) {
            console.error('Error chatting with GPT-5:', error);
            setAssistantReply('I wasn\'t able to reach the GPT-5 service. Please check the connection and try again.');
          } finally {
            chatInput.disabled = false;
            chatSubmit.disabled = false;
            chatInput.focus();
            scrollToBottom();
          }
        };

        chatForm.addEventListener('submit', (event) => {
          event.preventDefault();
          sendMessage(chatInput.value);
        });

        chatInput.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            chatForm.requestSubmit();
          }
        });

        promptButtons.forEach((button) => {
          button.addEventListener('click', () => {
            const prompt = button.getAttribute('data-prompt');
            if (!prompt) return;
            chatInput.value = prompt;
            chatInput.focus();
          });
        });

        const welcomeMessage = "Hi! I'm your Zendesk KPI copilot powered by GPT-5. Ask me anything about volume trends, SLA breaches, backlog, CSAT, or staffing and I'll synthesize the latest insights.";
        createMessageElement('assistant', welcomeMessage);
        conversation.push({ role: 'assistant', content: welcomeMessage });
      });
    </script>
  </body>
</html>
