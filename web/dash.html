<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.3.0
* @link https://tabler.io
* Copyright 2018-2025 The Tabler Authors
* Copyright 2018-2025 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Zendesk Dashboard - Voice & Tickets</title>
    <!-- BEGIN PAGE LEVEL STYLES -->
    <!-- END PAGE LEVEL STYLES -->
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="./original/dist/css/tabler.css?1747674014" rel="stylesheet" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PLUGINS STYLES -->
    <link href="./original/dist/css/tabler-flags.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-socials.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-payments.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-vendors.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-marketing.css?1747674014" rel="stylesheet" />
    <link href="./original/dist/css/tabler-themes.css?1747674014" rel="stylesheet" />
    <!-- END PLUGINS STYLES -->
    <!-- BEGIN DEMO STYLES -->
    <link href="./original/preview/css/demo.css?1747674014" rel="stylesheet" />
    <!-- END DEMO STYLES -->
    <!-- BEGIN CUSTOM FONT -->
    <style>
      @import url("https://rsms.me/inter/inter.css");
    </style>
    <!-- END CUSTOM FONT -->
  </head>
  <body>
    <!-- BEGIN GLOBAL THEME SCRIPT -->
    <script src="./original/dist/js/tabler-theme.min.js?1747674014"></script>
    <!-- END GLOBAL THEME SCRIPT -->
    <div class="page">
      <!-- BEGIN NAVBAR  -->
      <header class="navbar navbar-expand-md d-print-none">
        <div class="container-xl">
          <!-- BEGIN NAVBAR TOGGLER -->
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbar-menu"
            aria-controls="navbar-menu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <!-- END NAVBAR TOGGLER -->
          <!-- BEGIN NAVBAR LOGO -->
          <div class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href="." aria-label="Zendesk Dashboard">
              <h2 class="m-0">Zendesk Dashboard</h2>
            </a>
          </div>
          <!-- END NAVBAR LOGO -->
          <div class="navbar-nav flex-row order-md-last">
            <div class="d-none d-md-flex">
              <div class="nav-item">
                <a href="?theme=dark" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom">
                  <!-- Download SVG icon from http://tabler.io/icons/icon/moon -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="icon icon-1"
                  >
                    <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
                  </svg>
                </a>
                <a href="?theme=light" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom">
                  <!-- Download SVG icon from http://tabler.io/icons/icon/sun -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="icon icon-1"
                  >
                    <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- END NAVBAR  -->
      <div class="page-wrapper">
        <!-- BEGIN PAGE HEADER -->
        <div class="page-header d-print-none" aria-label="Page header">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <h2 class="page-title">Executive Dashboard</h2>
                <div class="text-secondary mt-1">Voice Calls & Ticket Status Trends</div>
              </div>
            </div>
          </div>
        </div>
        <!-- END PAGE HEADER -->
        <!-- BEGIN PAGE BODY -->
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-cards">
              <!-- 30-Day Call Analytics Section -->
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-phone" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"/>
                      </svg>
                      Call Analytics - Last 30 Days
                    </h3>
                    <div class="card-actions">
                      <button class="btn btn-outline-primary btn-sm" id="refresh-call-analytics">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                          <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                        </svg>
                        Refresh
                      </button>
                    </div>
                  </div>
                  <div class="card-body">
                    <!-- Call Analytics Summary Cards -->
                    <div class="row mb-4" id="call-summary-cards">
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-blue text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="total-calls-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Total Calls
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-green text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l5 5l10 -10"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="answered-calls-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Answered
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-red text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M18 6l-12 12"/>
                                    <path d="M6 6l12 12"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="abandoned-calls-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Abandoned
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-orange text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z"/>
                                    <path d="M3 7l9 6l9 -6"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="callbacks-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Callbacks
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-purple text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="voicemails-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Voicemails
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6 col-lg-2">
                        <div class="card card-sm">
                          <div class="card-body">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="bg-teal text-white avatar">
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M7 10l5 -6l5 6"/>
                                    <path d="M21 10l-2 8a2 2.1 0 0 1 -2 2h-10a2 2.1 0 0 1 -2 -2l-2 -8z"/>
                                    <path d="M12 15m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
                                  </svg>
                                </span>
                              </div>
                              <div class="col">
                                <div class="font-weight-medium" id="answer-rate-30day">
                                  Loading...
                                </div>
                                <div class="text-secondary">
                                  Answer Rate
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Call Analytics Chart -->
                    <div id="chart-call-analytics-30day" class="position-relative" style="height: 400px;"></div>
                    
                    <!-- Call Analytics Table -->
                    <div class="mt-4">
                      <div class="table-responsive">
                        <table class="table table-vcenter">
                          <thead>
                            <tr>
                              <th>Date</th>
                              <th>Day</th>
                              <th>Total</th>
                              <th>Answered</th>
                              <th>Abandoned</th>
                              <th>Callbacks</th>
                              <th>Voicemails</th>
                              <th>Answer Rate</th>
                            </tr>
                          </thead>
                          <tbody id="call-analytics-table">
                            <tr>
                              <td colspan="8" class="text-center text-secondary">Loading call analytics...</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- END PAGE BODY -->
        <!--  BEGIN FOOTER  -->
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    &copy; 2025 Zendesk Dashboard
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
        <!--  END FOOTER  -->
      </div>
    </div>
    <!-- BEGIN PAGE LIBRARIES -->
    <script src="./original/dist/libs/apexcharts/dist/apexcharts.min.js?1747674014" defer></script>
    <!-- END PAGE LIBRARIES -->
    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="./original/dist/js/tabler.min.js?1747674014" defer></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->
    <!-- BEGIN DEMO SCRIPTS -->
    <script src="./original/preview/js/demo.min.js?1747674014" defer></script>
    <!-- END DEMO SCRIPTS -->
    <!-- BEGIN PAGE SCRIPTS -->
    <script>
      // Dashboard State Management
      const DashboardApp = {
        callAnalyticsChart: null,
        isLoading: false,

        // Initialize dashboard when DOM is ready
        async init() {
          try {
            await this.loadCallAnalytics();
            this.setupEventListeners();
            console.log('✅ Dashboard initialized successfully');
          } catch (error) {
            console.error('❌ Dashboard initialization failed:', error);
            this.showError('Failed to initialize dashboard');
          }
        },

        // Setup event listeners (only called once)
        setupEventListeners() {
          // Refresh button
          const refreshBtn = document.getElementById('refresh-call-analytics');
          if (refreshBtn) {
            refreshBtn.addEventListener('click', () => this.handleRefresh());
          }
        },

        // Handle refresh button click
        async handleRefresh() {
          if (this.isLoading) return;
          
          const refreshBtn = document.getElementById('refresh-call-analytics');
          const originalHTML = refreshBtn.innerHTML;
          
          try {
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>Refreshing...';
            
            await this.loadCallAnalytics();
            
          } finally {
            refreshBtn.disabled = false;
            refreshBtn.innerHTML = originalHTML;
          }
        },

        // Load call analytics data (main API call)
        async loadCallAnalytics() {
          if (this.isLoading) return;
          this.isLoading = true;

          try {
            console.log('📊 Loading call analytics...');
            
            // Show loading state
            this.showLoadingState();
            
            // Single API call to get all data
            const response = await fetch('/api/call-analytics/30-day');
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            
            if (!result.success) {
              throw new Error(result.error || 'Failed to load call analytics');
            }
            
            // Update all UI components with the data
            this.updateSummaryCards(result.data.summary);
            this.updateTable(result.data.daily_breakdown);
            this.updateChart(result.data.chart_data);
            
            console.log('✅ Call analytics loaded successfully');
            
          } catch (error) {
            console.error('❌ Error loading call analytics:', error);
            this.showErrorState(error.message);
          } finally {
            this.isLoading = false;
          }
        },

        // Show loading state in all UI components
        showLoadingState() {
          const loadingText = 'Loading...';
          
          // Update summary cards
          document.getElementById('total-calls-30day').textContent = loadingText;
          document.getElementById('answered-calls-30day').textContent = loadingText;
          document.getElementById('abandoned-calls-30day').textContent = loadingText;
          document.getElementById('callbacks-30day').textContent = loadingText;
          document.getElementById('voicemails-30day').textContent = loadingText;
          document.getElementById('answer-rate-30day').textContent = loadingText;
          
          // Update table
          const tableBody = document.getElementById('call-analytics-table');
          tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-secondary">Loading call analytics...</td></tr>';
        },

        // Show error state in all UI components
        showErrorState(errorMessage) {
          const errorText = 'Error';
          
          // Update summary cards
          document.getElementById('total-calls-30day').textContent = errorText;
          document.getElementById('answered-calls-30day').textContent = errorText;
          document.getElementById('abandoned-calls-30day').textContent = errorText;
          document.getElementById('callbacks-30day').textContent = errorText;
          document.getElementById('voicemails-30day').textContent = errorText;
          document.getElementById('answer-rate-30day').textContent = errorText;
          
          // Update table
          const tableBody = document.getElementById('call-analytics-table');
          tableBody.innerHTML = `<tr><td colspan="8" class="text-center text-danger">Error: ${errorMessage}</td></tr>`;
          
          // Update chart
          document.getElementById('chart-call-analytics-30day').innerHTML = 
            `<div class="alert alert-danger">Error loading call analytics: ${errorMessage}</div>`;
        },

        // Update summary cards with data
        updateSummaryCards(summary) {
          document.getElementById('total-calls-30day').textContent = summary.total_calls.toLocaleString();
          document.getElementById('answered-calls-30day').textContent = summary.answered_calls.toLocaleString();
          document.getElementById('abandoned-calls-30day').textContent = summary.unanswered_calls.toLocaleString();
          document.getElementById('callbacks-30day').textContent = (summary.callbacks || 0).toLocaleString();
          document.getElementById('voicemails-30day').textContent = (summary.voicemails || 0).toLocaleString();
          document.getElementById('answer-rate-30day').textContent = summary.overall_answer_rate + '%';
        },

        // Update analytics table with daily breakdown
        updateTable(dailyData) {
          const tableBody = document.getElementById('call-analytics-table');
          tableBody.innerHTML = '';
          
          // Show newest data first
          const reversedData = [...dailyData].reverse();
          
          reversedData.forEach(day => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><strong>${day.date}</strong></td>
              <td><span class="badge bg-blue-lt">${day.day_name}</span></td>
              <td class="text-end">${day.total_calls.toLocaleString()}</td>
              <td class="text-end text-green">${day.answered_calls.toLocaleString()}</td>
              <td class="text-end text-red">${day.unanswered_calls.toLocaleString()}</td>
              <td class="text-end text-orange">${(day.callbacks || 0).toLocaleString()}</td>
              <td class="text-end text-purple">${(day.voicemails || 0).toLocaleString()}</td>
              <td class="text-end">
                <span class="badge ${this.getAnswerRateBadgeClass(day.answer_rate)}">
                  ${day.answer_rate}%
                </span>
              </td>
            `;
            tableBody.appendChild(row);
          });
        },

        // Get CSS class for answer rate badge based on percentage
        getAnswerRateBadgeClass(rate) {
          if (rate >= 80) return 'bg-green-lt';
          if (rate >= 60) return 'bg-yellow-lt';
          return 'bg-red-lt';
        },

        // Update call analytics chart
        updateChart(chartData) {
          // Destroy existing chart if it exists
          if (this.callAnalyticsChart) {
            this.callAnalyticsChart.destroy();
            this.callAnalyticsChart = null;
          }
          
          const chartElement = document.getElementById('chart-call-analytics-30day');
          
          this.callAnalyticsChart = new ApexCharts(chartElement, {
            chart: {
              type: 'bar',
              height: 400,
              stacked: true,
              fontFamily: 'inherit',
              toolbar: {
                show: true,
                tools: {
                  download: true,
                  selection: false,
                  zoom: false,
                  zoomin: false,
                  zoomout: false,
                  pan: false,
                  reset: false
                }
              },
              animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800
              }
            },
            series: [
              {
                name: 'Answered Calls',
                data: chartData.series.find(s => s.name === 'Answered Calls')?.data || []
              },
              {
                name: 'Abandoned in Queue',
                data: chartData.series.find(s => s.name === 'Abandoned in Queue')?.data || []
              },
              {
                name: 'Callback Requests',
                data: chartData.series.find(s => s.name === 'Callback Requests')?.data || []
              },
              {
                name: 'Voicemails',
                data: chartData.series.find(s => s.name === 'Voicemails')?.data || []
              },
              {
                name: 'Exceeded Wait Time',
                data: chartData.series.find(s => s.name === 'Exceeded Wait Time')?.data || []
              },
              {
                name: 'Outbound Calls',
                data: chartData.series.find(s => s.name === 'Outbound Calls')?.data || []
              }
            ],
            xaxis: {
              categories: chartData.categories,
              title: {
                text: 'Days',
                style: {
                  fontSize: '14px',
                  fontWeight: 500
                }
              },
              labels: {
                style: {
                  fontSize: '12px'
                }
              }
            },
            yaxis: {
              title: {
                text: 'Number of Calls',
                style: {
                  fontSize: '14px',
                  fontWeight: 500
                }
              },
              labels: {
                style: {
                  fontSize: '12px'
                }
              }
            },
            plotOptions: {
              bar: {
                horizontal: false,
                columnWidth: '55%',
                endingShape: 'rounded'
              }
            },
            dataLabels: {
              enabled: false
            },
            stroke: {
              show: true,
              width: 2,
              colors: ['transparent']
            },
            colors: ['#28a745', '#dc3545', '#fd7e14', '#6f42c1', '#ffc107', '#20c997'],
            fill: {
              opacity: 0.8
            },
            tooltip: {
              y: {
                formatter: function (val) {
                  return val + " calls"
                }
              }
            },
            legend: {
              position: 'top',
              horizontalAlign: 'left',
              offsetY: 0,
              fontSize: '13px'
            },
            grid: {
              borderColor: '#e7e7e7',
              row: {
                colors: ['#f3f3f3', 'transparent'],
                opacity: 0.5
              }
            }
          });
          
          this.callAnalyticsChart.render();
        },

        // Generic error display
        showError(message) {
          console.error('Dashboard Error:', message);
          // Could show a toast notification here in the future
        }
      };

      // Initialize dashboard when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        DashboardApp.init();
      });
    </script>
    <!-- END PAGE SCRIPTS -->
  </body>
</html>
